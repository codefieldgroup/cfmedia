{"version":3,"file":"cfmedia.min.js","sources":["cfmedia.min.js"],"names":["angular","module","directive","restrict","replace","transclude","require","scope","model","headTitle","apiUrl","srcUrl","multiple","returnModel","accept","order","filter","templateUrl","link","element","openMediaModal","find","modal","selectSave","controller","$scope","$timeout","Upload","Media","isDefined","elementsSelected","params","limit","offset","search","progress","copy","$watch","modelUpload","upload","file","forEach","item","url","fields","evt","progressPercentage","parseInt","loaded","total","success","result","elements","push","error","data","status","console","log","select","index","is","not","inArray","activeClass","value","key","splice","openMediaModalCtrl","getAll","selectSaveCtrl","length","meta","alert","loadMore","newValue"],"mappings":"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","sourcesContent":["'use strict';\n\nangular.module(\"cf\", [\n  'ngFileUpload'\n])\n\n/**\n * Directive to media upload as WordpressÂ´s media.\n * Example:\n *\n * <div cfmedia\n *   ng-model=\"test\"\n *   multiple=\"true\"\n *   url=\"/public/path/upload/\"\n *   accept=\"image/*,application/pdf\"\n *   api=\"api/media\"\n *   head=\"Upload Image\">\n *     <button type=\"button\" class=\"btn btn-default no-border\">View Media Upload</button>\n * </div>\n *\n * The directive accepts the following attributes:\n *\n * - 'ng-model' : Required.\n * - 'head'     : Optional. Default value is 'Change Image'. String with the title of the modal.\n * - 'api'      : Optional. Default value is 'api/media'. String with the route of api media.\n * - 'url'      : Optional. Default value is '/public/upload/'. String with the url to path of public images.\n * - 'multiple' : Optional. Default value is true. Boolean with the options to multiples images or not.\n * - 'return'   : Optional. Default value is 'object'. String with the format to return result, \"string\" or \"object\".\n *                If \"string\" then only return the meta field of image object.\n *                If \"object\" then return the image object.\n * - 'accept'   : Optional. Default value is 'image/*'. String with function or comma separated wildcard to filter files allowed.\n *                Other options:\n *                  .pdf,.jpg\n *                  image/*,application/pdf\n *                  audio/*\n *                  video/*\n * - 'order'    : Optional. Default value is 'date'. String with the option to order by elements result.\n * - 'filter'   : Optional. Default value is 'meta'. String with field name of object that contain image name, example: dc3443.png\n */\n  .directive('cfmedia', [function () {\n    return {\n      restrict   : 'A',\n      replace    : true,\n      transclude : true,\n      require    : '?ngModel',\n      scope      : {\n        model      : '=ngModel',\n        headTitle  : '@?head',\n        apiUrl     : '@?api',\n        srcUrl     : '@?url',\n        multiple   : '=?multiple',\n        returnModel: '@?return',\n        accept     : '@?',\n        order      : '@?',\n        filter     : '@?'\n      },\n      templateUrl: 'cfmedia.html',\n\n      link: function (scope, element) {\n        // Open modal.\n        scope.openMediaModal = function () {\n          element.find('.cfmedia-modal').modal();\n        };\n\n        scope.selectSave = function () {\n          element.find('.cfmedia-modal').modal('hide');\n        };\n      },\n\n      controller: ['$scope', '$timeout', 'Upload', 'Media', function ($scope, $timeout, Upload, Media) {\n        $scope.apiUrl = angular.isDefined($scope.apiUrl) ? $scope.apiUrl : 'api/media';\n        $scope.srcUrl = angular.isDefined($scope.srcUrl) ? $scope.srcUrl : '/public/upload/';\n\n        $scope.elementsSelected = [];\n\n        $scope.params = {\n          limit : 10,\n          offset: 0,\n          search: ''\n        };\n\n        if ($scope.apiUrl) {\n          $scope.progress = 0;\n          var originalModel = angular.copy($scope.model);\n\n          $scope.$watch('modelUpload', function () {\n            if ($scope.modelUpload) {\n              $scope.upload($scope.modelUpload);\n            }\n          });\n\n          /**\n           * Function to upload files.\n           *\n           * @param file\n           */\n          $scope.upload = function (file) {\n            angular.forEach(file, function (item) {\n              $scope.progress = '';\n              Upload.upload({\n                url   : $scope.apiUrl,\n                fields: {},\n                file  : item\n              }).progress(function (evt) {\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\n                $scope.progress = progressPercentage;\n              }).success(function (result) {\n                $scope.elements.push(result);\n              }).error(function (data, status, headers, config) {\n                console.log('error status: ' + status);\n              })\n            });\n          };\n\n          /**\n           * Function to instantiate and check the elements selected.\n           *\n           * @param element\n           * @param index\n           */\n          $scope.select = function (element, index) {\n            if (is.not.inArray(element, $scope.elementsSelected)) {\n              if ($scope.multiple) {\n                element.activeClass = true;\n                $scope.elementsSelected.push(element);\n              } else {\n                angular.forEach($scope.elements, function (value, key) {\n                  $scope.elements[key].activeClass = false;\n                });\n                element.activeClass = true;\n                $scope.elementsSelected = [];\n                $scope.elementsSelected.push(element);\n              }\n            } else {\n              angular.forEach($scope.elementsSelected, function (value, key) {\n                if (value == element) {\n                  $scope.elements[index].activeClass = false;\n                  $scope.elementsSelected.splice(key, 1);\n                }\n              });\n            }\n          };\n\n          /**\n           * Function to execute when open modal.\n           */\n          $scope.openMediaModalCtrl = function () {\n            $scope.multiple = angular.isDefined($scope.multiple) ? $scope.multiple : true;\n            $scope.headTitle = angular.isDefined($scope.headTitle) ? $scope.headTitle : 'Change Imagen';\n            $scope.returnModel = angular.isDefined($scope.returnModel) ? $scope.returnModel : 'object';\n            $scope.accept = angular.isDefined($scope.accept) ? $scope.accept : 'image/*';\n            $scope.order = angular.isDefined($scope.order) ? $scope.order : 'date';\n            $scope.filter = angular.isDefined($scope.filter) ? $scope.filter : 'meta';\n\n            $scope.params = {\n              limit : 10,\n              offset: 0,\n              search: ''\n            };\n\n            $scope.elementsSelected = [];\n            $scope.elements = [];\n\n            Media.getAll({\n              limit : $scope.params.limit,\n              offset: $scope.params.offset,\n              search: $scope.params.search\n            }, function (result) {\n              $scope.elements = angular.copy(result);\n            });\n          };\n\n          /**\n           * Function to instantiate model with the selected values.\n           */\n          $scope.selectSaveCtrl = function () {\n            if ($scope.elementsSelected.length > 0) {\n              if ($scope.multiple) {\n                if ($scope.returnModel == 'string') {\n                  angular.forEach($scope.elementsSelected, function (value) {\n                    $scope.model.push(value.meta);\n                  });\n                } else if ($scope.returnModel == 'object') {\n                  $scope.model = $scope.elementsSelected;\n                }\n              } else {\n                if ($scope.returnModel == 'string') {\n                  $scope.model = $scope.elementsSelected[0].meta;\n                } else if ($scope.returnModel == 'object') {\n                  $scope.model = $scope.elementsSelected[0];\n                }\n              }\n            } else {\n              alert('Please select one element.');\n            }\n          };\n\n          /**\n           * Function to load more elements from DB.\n           */\n          $scope.loadMore = function () {\n            $scope.params.offset = ($scope.params.offset == 0) ? $scope.params.offset + $scope.params.limit : $scope.params.offset + $scope.params.offset;\n\n            Media.getAll({\n              limit : $scope.params.limit,\n              offset: $scope.params.offset,\n              search: $scope.params.search\n            }, function (result) {\n              if (result.length > 0) {\n                angular.forEach(result, function (value) {\n                  $scope.elements.push(value);\n                });\n              } else {\n                alert('No more elements in DB.');\n              }\n            });\n          };\n\n          $scope.$watch('search', function (newValue) {\n            $scope.params.search = newValue;\n            $scope.params.offset = 0;\n\n            Media.getAll({\n              limit : $scope.params.limit,\n              offset: $scope.params.offset,\n              search: $scope.params.search\n            }, function (result) {\n              if (result.length > 0) {\n                $scope.elements = angular.copy(result);\n              } else {\n                alert('No more elements in DB.');\n              }\n            });\n          });\n        }\n      }]\n    }\n  }]);"]}